<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Link Start! - File Master V25.0 (Titanium)</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="theme-color" content="#0d1117">

    <link rel="manifest" href="manifest.json">
    
    <link rel="apple-touch-icon" href="‡∏Ñ‡∏¥‡∏£‡∏¥‡πÇ‡∏ï‡∏∞.jpg">
    <link rel="icon" type="image/png" href="‡∏Ñ‡∏¥‡∏£‡∏¥‡πÇ‡∏ï‡∏∞.jpg">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
</head>
<body class="bg-grid p-4 md:p-8" onclick="initAudio()">

    <div id="modal" onclick="closeModal()">
        <div class="relative w-full h-full flex items-center justify-center p-4">
            <img id="modalImg" src="" onclick="event.stopPropagation()" class="max-w-full max-height-full transition-transform duration-200 shadow-2xl border-2 border-white">
            <div class="absolute top-4 right-4 flex gap-2">
                <button onclick="closeModal()" class="bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors">‚úï</button>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8 relative z-10">
        
        <div class="lg:col-span-4 space-y-6">
            <div class="kirito-card p-6 rounded-2xl">
                
                <div class="flex gap-2 mb-6 justify-center border-b border-slate-800 pb-4">
                    <input type="file" id="bgInput" accept="image/*" class="hidden" onchange="changeBackground(this)">
                    <button onclick="playClick(); document.getElementById('bgInput').click();" class="btn-action font-thai text-[10px]" onmouseenter="playHover()">üñºÔ∏è BG</button>
                    <button onclick="playClick(); toggleMatrix();" class="btn-action text-[9px] px-2 py-1 font-thai text-green-400 border-green-500/50" onmouseenter="playHover()">üíª Matrix</button>
                    <button onclick="setTheme('neon'); playClick()" class="btn-action text-[9px] px-2 py-1" onmouseenter="playHover()">üîµ ‡∏ô‡∏µ‡∏≠‡∏≠‡∏ô</button>
                    <button onclick="setTheme('pure-dark'); playClick()" class="btn-action text-[9px] px-2 py-1" onmouseenter="playHover()">‚ö´ ‡∏î‡∏≥‡∏•‡πâ‡∏ß‡∏ô</button>
                </div>

                <div class="flex justify-between items-start mb-4">
                    <h1 class="font-numeric text-xl font-black italic tracking-widest text-white uppercase neon-alive">
                        Link Start <span class="text-[10px] not-italic text-blue-500 font-normal">V25.0</span>
                    </h1>
                    <button onclick="resetSystem(); playClick()" class="text-[9px] text-red-500 font-bold hover:bg-red-500/10 border border-red-900/50 px-2 py-1 rounded transition-all font-thai">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
                </div>
                
                <div class="grid grid-cols-3 gap-2 mb-4">
                    <button onclick="loadPreset(1)" class="btn-action text-[9px] py-1 border-blue-500/30" onmouseenter="playHover()">üíæ ‡∏™‡∏π‡∏ï‡∏£ 1</button>
                    <button onclick="loadPreset(2)" class="btn-action text-[9px] py-1 border-blue-500/30" onmouseenter="playHover()">üíæ ‡∏™‡∏π‡∏ï‡∏£ 2</button>
                    <button onclick="loadPreset(3)" class="btn-action text-[9px] py-1 border-blue-500/30" onmouseenter="playHover()">üíæ ‡∏™‡∏π‡∏ï‡∏£ 3</button>
                </div>

                <div id="dropZone" 
                    class="border-2 border-dashed border-slate-700 rounded-xl p-8 text-center cursor-pointer hover:border-blue-500 transition-all mb-4 relative overflow-hidden" 
                    onclick="document.getElementById('fileInput').click(); playClick()"
                    ondragover="event.preventDefault(); this.classList.add('border-blue-500'); playHover()"
                    ondragleave="this.classList.remove('border-blue-500');"
                    ondrop="event.preventDefault(); this.classList.remove('border-blue-500'); handleFiles(event.dataTransfer.files); playSuccess()">
                    
                    <input type="file" id="fileInput" class="hidden" multiple 
                    accept="image/*, .pdf, .zip, .docx, .xlsx, .pptx, .epub, .cbz, .jar, .apk, .svg, .ico" 
                    onchange="handleFiles(this.files); playSuccess()">
                    
                    <div class="text-3xl mb-1">‚ö°</div>
                    <p id="statusText" class="text-[12px] font-bold text-slate-500 font-thai">
                        ‡∏Ñ‡∏•‡∏¥‡∏Å, ‡∏•‡∏≤‡∏Å‡∏ß‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠ <span class="text-blue-400 bg-blue-500/10 px-1 rounded">Ctrl+V</span>
                    </p>

                    <div id="pContainer" class="progress-container mt-4 hidden">
                        <div class="w-full bg-slate-800 rounded-full h-1.5 mb-1">
                            <div id="pBar" class="bg-blue-500 h-1.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <span class="text-[10px] text-blue-400 font-thai">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</span>
                    </div>
                </div>

                <div class="input-group mb-4 space-y-2">
                    <div class="flex justify-between items-center">
                        <label class="text-[12px] font-bold text-blue-400 font-thai tracking-widest block">‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå (Smart Rename)</label>
                        <button onclick="insertDate('newName'); playClick()" class="text-[9px] bg-slate-800 hover:bg-slate-700 text-blue-300 px-2 py-1 rounded font-thai">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</button>
                    </div>
                    <select id="renameMode" onchange="handleRename(); playClick()" class="dropdown-sci !rounded-full">
                        <option value="replace">‚ö° ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏´‡∏°‡∏î (Replace All)</option>
                        <option value="prefix">‚èÆÔ∏è ‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ + ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏° (Prefix)</option>
                        <option value="suffix">‚è≠Ô∏è ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏° + ‡∏Ñ‡∏≥‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢ (Suffix)</option>
                    </select>
                    <div class="input-wrapper relative">
                        <input type="text" id="newName" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£..." 
                            class="input-sci w-full text-sm font-bold font-thai py-3 px-4 rounded-lg bg-slate-900/50 border border-slate-700 focus:border-blue-500 outline-none transition-all" 
                            oninput="handleRename()">
                    </div> 
                </div> 
                
                <div class="input-group space-y-3 bg-slate-900/30 p-3 rounded-lg border border-slate-800">
                    <div class="flex justify-between items-center">
                        <label class="text-[12px] font-bold text-slate-500 font-thai">‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û (Quality)</label>
                        <input type="number" id="inputQuality" value="90" min="10" max="100" class="input-num !w-14 text-center bg-blue-500/10 text-blue-400 border border-blue-500/30 rounded font-numeric text-xs py-1" oninput="syncRange('quality')">
                    </div>
                    <div class="range-wrapper py-1">
                        <input type="range" id="quality" min="0.1" max="1.0" step="0.05" value="0.90" class="w-full h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-blue-500" oninput="syncInput('quality')">
                    </div>
                    
                    <div class="flex justify-between items-center pt-2 border-t border-slate-800/50">
                        <label class="text-[10px] font-bold text-slate-400 font-thai">üìè ‡∏ö‡∏µ‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á (Max Width)</label>
                        <div class="relative w-20">
                            <input type="number" id="inputMaxWidth" placeholder="Original" class="input-num !w-full text-center text-xs py-1" oninput="updateAllDebounced()">
                            <span class="absolute right-1 top-1 text-[8px] text-slate-600">px</span>
                        </div>
                    </div>
                    <div class="text-[8px] text-slate-600 text-right font-thai">*‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á = ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏î‡∏¥‡∏°</div>
                </div>

                <div class="mt-4 border-t border-slate-800 pt-4">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-[10px] font-bold text-slate-500 font-thai">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå (‡∏•‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏á)</label>
                        <span class="text-[9px] text-blue-500 animate-pulse">‚óè Drag Enabled</span>
                    </div>
                    <div id="fileList" class="space-y-2 max-h-40 overflow-y-auto pr-2 text-xs font-bold text-slate-400 font-thai"></div>
                </div>
                
                <button onclick="clearAll(); playClick()" class="w-full mt-4 text-[10px] text-slate-600 hover:text-red-500 font-bold font-thai transition-colors">√ó ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
            </div>

            <div class="kirito-card p-6 rounded-2xl">
                <div class="flex justify-between items-center mb-6 border-l-2 border-blue-500 pl-2">
                    <h2 class="text-xs font-bold font-numeric text-blue-400 uppercase tracking-widest">ENGINE & FX</h2>
                    <div class="flex items-center gap-2">
                        <div class="flex items-center gap-1 mr-2" title="‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏•‡∏ö Metadata (EXIF) ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏™‡∏°‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢">
                            <span class="text-[8px] text-green-500 font-bold">üõ°Ô∏è Privacy (Always Active)</span>
                            
                            <input type="checkbox" id="privacyToggle" class="hidden" checked disabled>
                        </div>
                        <span id="wmStatusText" class="text-[9px] font-bold text-blue-400">‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥: ‡πÄ‡∏õ‡∏¥‡∏î</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="wmToggle" class="sr-only peer" checked onchange="toggleWM(); playClick()">
                            <div class="w-8 h-4 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-blue-500"></div>
                        </label>
                    </div>
                </div>

                <div id="wmControls" class="space-y-6">
                    <div class="grid grid-cols-4 gap-1">
                        <button onclick="setMode('filename'); playClick()" id="mode-filename" class="btn-action p-2 text-[10px] active font-thai font-bold">üóíÔ∏è ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå</button>
                        <button onclick="setMode('custom'); playClick()" id="mode-custom" class="btn-action p-2 text-[10px] font-thai font-bold">üì¢ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                        <button onclick="document.getElementById('wmLogoInput').click(); playClick()" id="mode-logo" class="btn-action p-2 text-[10px] font-thai font-bold">üñºÔ∏è ‡πÇ‡∏•‡πÇ‡∏Å‡πâ</button>
                        <button onclick="setMode('qrcode'); playClick()" id="mode-qrcode" class="btn-action p-2 text-[10px] font-thai font-bold">üì± QR Code</button>
                        <input type="file" id="wmLogoInput" class="hidden" accept="image/*" onchange="loadLogo(this)">
                    </div>

                    <div id="customTextContainer" class="hidden relative">
                         <textarea id="customText" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥..." class="input-sci text-xs h-16 w-full p-3 bg-slate-900/50 border border-slate-700 rounded-lg focus:border-blue-500 outline-none font-thai" oninput="updateAllDebounced()"></textarea>
                         <button onclick="insertDate('customText'); playClick()" class="absolute bottom-2 right-2 text-[8px] bg-slate-800 hover:bg-slate-700 text-blue-300 px-2 py-1 rounded font-thai border border-slate-600">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</button>
                    </div>

                    <input type="text" id="qrInput" placeholder="‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á QR..." class="hidden input-sci w-full text-xs p-3 rounded-lg bg-slate-900/50 border border-slate-700 focus:border-blue-500 outline-none font-thai" oninput="updateAllDebounced()">

                    <div class="border border-slate-800 rounded-lg p-3 bg-slate-900/30 space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-[10px] text-slate-500 font-bold font-thai">‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏†‡∏≤‡∏û (Color Filter)</span>
                            <button onclick="resetFX(); playClick()" class="text-[8px] text-yellow-500 hover:text-yellow-400 cursor-pointer font-bold">‚Ü∫ ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°</button>
                        </div>
                        
                        <div class="flex justify-between items-center"><span class="text-[9px] text-slate-500">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡πà‡∏≤‡∏á</span> <span id="val-bright" class="text-[9px] text-blue-400">100%</span></div>
                        <input type="range" id="fxBright" min="0" max="200" value="100" class="w-full h-1 bg-slate-700 rounded-lg appearance-none accent-blue-500" oninput="updateFX('bright')">
                        
                        <div class="flex justify-between items-center"><span class="text-[9px] text-slate-500">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏°‡∏ä‡∏±‡∏î</span> <span id="val-contrast" class="text-[9px] text-blue-400">100%</span></div>
                        <input type="range" id="fxContrast" min="0" max="200" value="100" class="w-full h-1 bg-slate-700 rounded-lg appearance-none accent-blue-500" oninput="updateFX('contrast')">

                        <div class="flex justify-between items-center"><span class="text-[9px] text-slate-500">‡∏Ç‡∏≤‡∏ß-‡∏î‡∏≥</span> <span id="val-gray" class="text-[9px] text-blue-400">0%</span></div>
                        <input type="range" id="fxGray" min="0" max="100" value="0" class="w-full h-1 bg-slate-700 rounded-lg appearance-none accent-blue-500" oninput="updateFX('gray')">
                    </div>

                    <div class="grid grid-cols-[110px_minmax(0,1fr)] gap-3 items-stretch">
                        
                        <div class="bg-slate-900/40 border border-slate-700/50 rounded-lg p-2 flex flex-col items-center justify-center gap-1 shrink-0">
                            <div class="text-[8px] text-slate-500 font-bold font-numeric w-full text-center border-b border-slate-800 pb-1 mb-1">POS</div>
                            <div class="grid grid-cols-3 gap-1">
                                <button onclick="setPos('tl'); playClick()" id="btn-tl" class="btn-action text-[10px] w-7 h-7 flex items-center justify-center rounded">‚ÜñÔ∏è</button>
                                <button onclick="setPos('tc'); playClick()" id="btn-tc" class="btn-action text-[10px] w-7 h-7 flex items-center justify-center rounded">‚¨ÜÔ∏è</button>
                                <button onclick="setPos('tr'); playClick()" id="btn-tr" class="btn-action text-[10px] w-7 h-7 flex items-center justify-center rounded">‚ÜóÔ∏è</button>
                                <button onclick="setPos('ml'); playClick()" id="btn-ml" class="btn-action text-[10px] w-7 h-7 flex items-center justify-center rounded">‚¨ÖÔ∏è</button>
                                <button onclick="setPos('mc'); playClick()" id="btn-mc" class="btn-action text-[10px] w-7 h-7 flex items-center justify-center rounded active">‚è∫Ô∏è</button>
                                <button onclick="setPos('mr'); playClick()" id="btn-mr" class="btn-action text-[10px] w-7 h-7 flex items-center justify-center rounded">‚û°Ô∏è</button>
                                <button onclick="setPos('bl'); playClick()" id="btn-bl" class="btn-action text-[10px] w-7 h-7 flex items-center justify-center rounded">‚ÜôÔ∏è</button>
                                <button onclick="setPos('bc'); playClick()" id="btn-bc" class="btn-action text-[10px] w-7 h-7 flex items-center justify-center rounded">‚¨áÔ∏è</button>
                                <button onclick="setPos('br'); playClick()" id="btn-br" class="btn-action text-[10px] w-7 h-7 flex items-center justify-center rounded">‚ÜòÔ∏è</button>
                            </div>
                        </div>
                        
                        <div class="bg-slate-900/40 border border-slate-700/50 rounded-lg p-3 space-y-3 flex flex-col justify-center min-w-0">
                            <div class="flex justify-between items-center border-b border-slate-800 pb-1">
                                <span class="text-[8px] text-slate-500 font-bold font-numeric">COLOR & GRADIENT</span>
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="gradientToggle" class="sr-only peer" onchange="toggleGradient(); playClick()">
                                    <div class="w-6 h-3 bg-gray-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-2.5 after:w-2.5 after:transition-all peer-checked:bg-purple-600"></div>
                                    <span class="ml-1 text-[8px] font-bold text-purple-400">GRAD</span>
                                </label>
                            </div>

                            <div class="flex gap-2">
                                <div class="color-picker-wrapper shadow-sm h-8 w-full">
                                    <input type="color" id="color" value="#00d2ff" oninput="updateAllDebounced()">
                                </div>
                                <div id="gradColorContainer" class="color-picker-wrapper shadow-sm h-8 w-full hidden">
                                    <input type="color" id="color2" value="#ff00d2" oninput="updateAllDebounced()">
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-2">
                                <div class="flex gap-0.5 bg-slate-800/50 p-0.5 rounded border border-slate-700/50 shrink-0">
                                   <button onclick="toggleStyle('bold'); playClick()" id="btn-bold" class="btn-action w-7 h-7 text-xs flex items-center justify-center border-0 hover:bg-slate-700 rounded"><b>B</b></button>
                                   <button onclick="toggleStyle('italic'); playClick()" id="btn-italic" class="btn-action w-7 h-7 text-xs flex items-center justify-center border-0 hover:bg-slate-700 rounded"><em>I</em></button>
                                   <button onclick="toggleStyle('underline'); playClick()" id="btn-underline" class="btn-action w-7 h-7 text-xs flex items-center justify-center border-0 hover:bg-slate-700 rounded"><u>U</u></button>
                                </div>
                                <div class="flex gap-1 flex-1 min-w-[120px]">
                                    <button onclick="toggleStyle('stroke'); playClick()" id="btn-stroke" class="btn-action flex-1 text-[9px] font-thai whitespace-nowrap px-1">‚ö´ ‡∏Ç‡∏≠‡∏ö</button>
                                    <button onclick="toggleStyle('shadow'); playClick()" id="btn-shadow" class="btn-action flex-1 text-[9px] font-thai whitespace-nowrap px-1">üåë ‡πÄ‡∏á‡∏≤</button>
                                    <button onclick="toggleStyle('tile'); playClick()" id="btn-tile" class="btn-action flex-1 text-[9px] font-thai whitespace-nowrap px-1">üß± ‡∏õ‡∏π</button>
                                 </div>
                            </div>

                            <div class="flex items-center gap-2 pt-1 border-t border-slate-800/50">
                                <span class="text-[10px] text-slate-500 font-bold font-thai shrink-0">‡∏´‡∏°‡∏∏‡∏ô</span>
                                <input type="range" id="rotationRange" value="0" min="0" max="360" step="1" class="flex-1 h-1 bg-slate-700 rounded-lg appearance-none accent-blue-500 min-w-0" oninput="syncRotation('range')">
                                <input type="number" id="rotationNum" value="0" min="0" max="360" class="input-num !w-10 text-center text-[9px] py-0" oninput="syncRotation('num')">
                            </div>
                        </div>
                    </div>

                    <div class="space-y-5 border-t border-slate-800 pt-5">
                        <div class="input-group space-y-2">
                            <div class="flex justify-between items-center">
                                <span class="text-[10px] font-bold text-slate-500 font-thai">‡∏Ç‡∏ô‡∏≤‡∏î (Size)</span>
                                <input type="number" id="inputSize" value="80" class="input-num !w-14 text-center bg-blue-500/10 text-blue-400 border border-blue-500/30 rounded font-numeric text-xs py-1" oninput="syncRange('size')">
                            </div>
                            <input type="range" id="fontSize" min="10" max="400" value="80" class="w-full h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-blue-500" oninput="syncInput('size')">
                        </div>
                        <div class="input-group space-y-2">
                            <div class="flex justify-between items-center">
                                <span class="text-[10px] font-bold text-slate-500 font-thai">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏á (Alpha)</span>
                                <input type="number" id="inputOpacity" value="0.5" step="0.1" class="input-num !w-14 text-center bg-blue-500/10 text-blue-400 border border-blue-500/30 rounded font-numeric text-xs py-1" oninput="syncRange('opac')">
                            </div>
                            <input type="range" id="opacity" min="0" max="1" step="0.1" value="0.5" class="w-full h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-blue-500" oninput="syncInput('opac')">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="lg:col-span-8 space-y-6">
            <div class="kirito-card p-6 rounded-3xl min-h-[85vh] flex flex-col">
                <div class="flex flex-wrap justify-between items-center gap-4 mb-8">
                    <h2 class="font-numeric text-xl font-black text-white italic uppercase tracking-widest">
                        Workspace <span id="count" class="text-blue-500 ml-4 text-xs font-normal">0 FILES</span>
                    </h2>
                    <div class="flex flex-wrap gap-2 items-center">

                        <div class="flex items-center gap-2 mr-2 bg-slate-900/50 p-1 rounded-lg border border-slate-700">

                             <span class="text-[9px] font-bold text-slate-500 px-1">Format:</span>

                             <select id="saveFormat" class="bg-slate-800 text-blue-400 border border-slate-600 rounded px-2 py-1 text-xs font-bold outline-none hover:border-blue-400 transition-colors mr-2">
                                <option value="image/jpeg"> .JPG (ZIP)</option>
                                <option value="image/png"> .PNG (ZIP)</option>
                                <option value="image/webp"> .WEBP (ZIP)</option>
                                <option value="application/pptx"> PowerPoint (.pptx)</option>
                                <option value="application/docx"> Word (.docx)</option>
                            </select>

                        </div>

                        <button onclick="saveAllAuto(); playSuccess()" class="btn-action px-5 py-2 text-[10px] !bg-green-500/20 !border-green-500 !text-green-400 hover:!bg-green-500 hover:!text-black font-thai font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏¢‡∏Å (Auto)</button>
                        <button onclick="downloadAll('zip'); playSuccess()" class="btn-action px-5 py-2 text-[10px] font-thai font-bold">‡πÇ‡∏´‡∏•‡∏î ZIP</button>
                        <button onclick="downloadPDF(); playSuccess()" class="btn-action px-5 py-2 text-[10px] font-thai font-bold">‡∏£‡∏ß‡∏° PDF</button>
                    </div>
                </div>

                <div id="resultGrid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6"></div>
                <div id="emptyState" class="flex-1 flex flex-col items-center justify-center text-slate-800 font-thai tracking-widest text-[12px]">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... (AWAITING_DATA)</div>
            </div>
        </div>
    </div>

    <script>

        // --- FIX: Real Debounce ---
        let debounceTimer;
        function updateAllDebounced() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                updateAll();
            }, 50); // ‡∏£‡∏≠ 50ms ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏¢‡∏∏‡∏î‡∏•‡∏≤‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏≠‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•
        }

        window.addEventListener('paste', e => {
            const items = (e.clipboardData || window.clipboardData).items;
            let blobs = [];
            for (let item of items) {
                // ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                if (item.kind === 'file' && item.type.startsWith('image/')) {
                    const blob = item.getAsFile();
                    // ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ Screenshot (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠)
                    if (!blob.name || blob.name === 'image.png') {
                        blob.name = `Screenshot_${new Date().getTime()}.png`;
                    }
                    blobs.push(blob);
                }
            }
            if (blobs.length > 0) {
                e.preventDefault(); // ‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏õ‡πÇ‡∏ú‡∏•‡πà‡πÉ‡∏ô input
                handleFiles(blobs);
                if(typeof playSuccess === 'function') playSuccess();
                if(typeof initAudio === 'function') initAudio();
            }
        });

        // --- NEW: Sortable Logic ---
        let sortableInstance;
        function initSortable() {
            const el = document.getElementById('fileList');
            if (sortableInstance) sortableInstance.destroy();
            
            sortableInstance = Sortable.create(el, {
                animation: 250,
                ghostClass: 'bg-blue-900/50', // Class ‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡∏≤‡∏Å
               onEnd: function (evt) {
                    const oldIndex = evt.oldIndex;
                    const newIndex = evt.newIndex;
                    if (oldIndex !== newIndex) {
                        const movedItem = filesArray.splice(oldIndex, 1)[0];
                        filesArray.splice(newIndex, 0, movedItem);
                        render(); 
                        
                        updateAll(); // <--- ‡πÄ‡∏ï‡∏¥‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö! ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ
                        
                        playClick();
                    }
                }
            });
        }

        // --- Sound FX System ---
        let audioCtx = null;
        let audioEnabled = false;

        function ensureAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function initAudio() {
            ensureAudio();
            if (!audioEnabled && audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            audioEnabled = true;
        }

        function playTone(freq, type = "sine", duration = 0.15) {
            ensureAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);

            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);

            osc.connect(gain);
            gain.connect(audioCtx.destination);

            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        // --- FIX: Mobile Audio check ---
        function playHover() { 
            // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ Hover (‡∏°‡∏µ‡πÄ‡∏°‡∏≤‡∏™‡πå) ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            if (window.matchMedia("(hover: hover)").matches) {
                playTone(800, 'sine', 0.05); 
            }
        }
        function playClick() { playTone(1200, 'square', 0.1); }
        function playSuccess() { 
            playTone(400, 'triangle', 0.1); 
            setTimeout(() => playTone(800, 'triangle', 0.2), 100); 
        }

        // --- 2. Presets System ---
        function loadPreset(id) {
            const saved = localStorage.getItem(`LinkStart_Preset_${id}`);
            if (saved) {
                const s = JSON.parse(saved);
                document.getElementById('fontSize').value = s.size || 80;
                document.getElementById('opacity').value = s.opac || 0.5;
                document.getElementById('color').value = s.color || "#00d2ff";
                if(s.color2) document.getElementById('color2').value = s.color2;
                if(s.isGradient) { document.getElementById('gradientToggle').checked = true; toggleGradient(); }
                else { document.getElementById('gradientToggle').checked = false; toggleGradient(); }
                
                setPos(s.pos || 'mc');
                styles = s.styles || { bold: true };
                document.getElementById('btn-bold').classList.toggle('active', styles.bold);
                
                // New Features in Preset
                if (s.maxWidth) document.getElementById('inputMaxWidth').value = s.maxWidth;

                syncInput('size'); syncInput('opac');
                updateAll();
                playSuccess();
                alert(`‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏π‡∏ï‡∏£ ${id} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!`);
            } else {
                if(confirm(`‡∏™‡∏π‡∏ï‡∏£ ${id} ‡∏¢‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏•‡∏á‡πÉ‡∏ô‡∏™‡∏π‡∏ï‡∏£ ${id} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                    savePreset(id);
                }
            }
        }

        function savePreset(id) {
            const s = {
                size: document.getElementById('fontSize').value,
                opac: document.getElementById('opacity').value,
                color: document.getElementById('color').value,
                color2: document.getElementById('color2').value,
                isGradient: document.getElementById('gradientToggle').checked,
                pos: currentPos,
                styles: styles,
                maxWidth: document.getElementById('inputMaxWidth').value
            };
            localStorage.setItem(`LinkStart_Preset_${id}`, JSON.stringify(s));
            playSuccess();
            alert(`‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏π‡∏ï‡∏£ ${id} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!`);
        }

        function changeBackground(input) {
            if (input.files && input.files[0]) {
                // ‡∏•‡πâ‡∏≤‡∏á URL ‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∑‡∏ô RAM
                const oldUrl = document.body.style.getPropertyValue('--user-bg-url');
                if (oldUrl && oldUrl.includes('blob:')) {
                    const cleanUrl = oldUrl.replace(/url\(['"]?(.*?)['"]?\)/, '$1');
                    URL.revokeObjectURL(cleanUrl);
                }

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ö‡∏ö Blob (‡πÄ‡∏ö‡∏≤‡∏Å‡∏ß‡πà‡∏≤ Base64 ‡πÄ‡∏î‡∏¥‡∏° 100 ‡πÄ‡∏ó‡πà‡∏≤)
                const file = input.files[0];
                const url = URL.createObjectURL(file);
                document.body.style.setProperty('--user-bg-url', `url(${url})`);
                document.body.classList.add('has-custom-bg');
                
                // Reset ‡∏Ñ‡πà‡∏≤ input ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                input.value = ''; 
            }
        }
        let currentTheme = 'default';
        function setTheme(theme) {
            currentTheme = theme;
            const body = document.body;
            body.classList.remove('theme-pure-dark', 'theme-light');
            if (theme === 'pure-dark') body.classList.add('theme-pure-dark');
            else if (theme === 'light') body.classList.add('theme-light');
            saveSettings();
        }

        let filesArray = [];
        let currentPos = 'mc';
        let watermarkMode = 'filename';
        let watermarkLogo = null;
        let qrCachedImg = null;
        let styles = { bold: true, italic: false, underline: false, stroke: false, shadow: false, tile: false };
        let filters = { bright: 100, contrast: 100, gray: 0 };
        let isWMEnabled = true;
        let isGradient = false;

        function saveSettings() {
            const settings = {
                theme: currentTheme,
                pos: currentPos,
                styles: styles,
                filters: filters,
                mode: watermarkMode,
                wmEnabled: isWMEnabled,
                renameMode: document.getElementById('renameMode').value,
                customText: document.getElementById('customText').value,
                qrText: document.getElementById('qrInput').value,
                color: document.getElementById('color').value,
                color2: document.getElementById('color2').value,
                isGradient: isGradient,
                rot: document.getElementById('rotationNum').value,
                size: document.getElementById('fontSize').value,
                opac: document.getElementById('opacity').value,
                quality: document.getElementById('quality').value,
                maxWidth: document.getElementById('inputMaxWidth').value, // Save new feature
                outputFormat: document.getElementById('outputFormat').value // Save format
            };
            localStorage.setItem('LinkStart_Config_V25', JSON.stringify(settings));
        }

        function loadSettings() {
            const data = localStorage.getItem('LinkStart_Config_V25');
            if (!data) return;

            try {
                const s = JSON.parse(data);
                if (s.theme) setTheme(s.theme);
                if (s.pos) setPos(s.pos);
                
                if (s.styles) {
                    styles = s.styles;
                    document.getElementById('btn-bold').classList.toggle('active', styles.bold);
                    document.getElementById('btn-italic').classList.toggle('active', styles.italic);
                    document.getElementById('btn-underline').classList.toggle('active', styles.underline);
                    if(document.getElementById('btn-stroke')) document.getElementById('btn-stroke').classList.toggle('active', styles.stroke);
                    if(document.getElementById('btn-shadow')) document.getElementById('btn-shadow').classList.toggle('active', styles.shadow);
                    if(document.getElementById('btn-tile')) document.getElementById('btn-tile').classList.toggle('active', styles.tile);
                }

                if (s.filters) {
                    filters = s.filters;
                    document.getElementById('fxBright').value = filters.bright || 100;
                    document.getElementById('fxContrast').value = filters.contrast || 100;
                    document.getElementById('fxGray').value = filters.gray || 0;
                    updateFXDisplay();
                }

                if (s.mode) { if (s.mode === 'logo') setMode('filename'); else setMode(s.mode); }
                if (s.wmEnabled !== undefined) { document.getElementById('wmToggle').checked = s.wmEnabled; toggleWM(); }
                if (s.renameMode) document.getElementById('renameMode').value = s.renameMode;
                if (s.customText !== undefined) document.getElementById('customText').value = s.customText;
                if (s.qrText !== undefined) document.getElementById('qrInput').value = s.qrText;
                if (s.color) document.getElementById('color').value = s.color;
                if (s.color2) document.getElementById('color2').value = s.color2;
                
                if (s.isGradient !== undefined) { 
                    document.getElementById('gradientToggle').checked = s.isGradient; 
                    toggleGradient(); 
                }

                if (s.rot) { document.getElementById('rotationNum').value = s.rot; syncRotation('num'); }
                if (s.size) { document.getElementById('fontSize').value = s.size; syncInput('size'); }
                if (s.opac) { document.getElementById('opacity').value = s.opac; syncInput('opac'); }
                if (s.quality) { document.getElementById('quality').value = s.quality; syncInput('quality'); }
                
                // Load New Features
                if (s.maxWidth) document.getElementById('inputMaxWidth').value = s.maxWidth;
                if (s.outputFormat) document.getElementById('outputFormat').value = s.outputFormat;

            } catch (e) {
                console.error("Load Config Error:", e);
                localStorage.removeItem('LinkStart_Config_V25');
            }
        }

        // --- FIX: Wait for Fonts ---
        window.addEventListener('load', () => { 
            loadSettings();
            // ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏≠‡∏¢‡∏™‡∏±‡πà‡∏á‡∏ß‡∏≤‡∏î
            document.fonts.ready.then(() => {
                updateAll();
            });
        });
        
        const modal = document.getElementById('modal');
        const modalImg = document.getElementById('modalImg');

        modal.addEventListener('wheel', function(e) {
            e.preventDefault();
            const speed = 0.1;
            let zoom = parseFloat(modalImg.getAttribute('data-zoom') || 1);
            if (e.deltaY < 0) zoom += speed;
            else zoom = Math.max(0.1, zoom - speed);
            modalImg.style.transform = `scale(${zoom})`;
            modalImg.setAttribute('data-zoom', zoom);
        }, { passive: false });

        function openLarge(id, type = 'result') {
            modalImg.style.transform = `scale(1)`;
            modalImg.setAttribute('data-zoom', 1);
            if (type === 'source') {
                const item = filesArray.find(f => f.id === id);
                if(item) { modalImg.src = item.thumb; modal.classList.add('active'); }
            } else {
                const cvs = document.getElementById(`canvas-${id}`);
                if(cvs) { modalImg.src = cvs.toDataURL('image/jpeg', 0.95); modal.classList.add('active'); }
            }
        }

        function closeModal() { modal.classList.remove('active'); }

        function loadImage(file) {
            return new Promise(res => {
                const reader = new FileReader();
                reader.onload = (e) => { 
                    const img = new Image(); 
                    img.onload = () => res(img); 
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡πÄ‡∏™‡∏µ‡∏¢ ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤ null ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ (‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏î‡∏≥)
                    img.onerror = () => {
                        console.error("Image Load Failed");
                        res(null);
                    };
                    img.src = e.target.result; 
                };
                reader.readAsDataURL(file);
            });
        }

        async function handleFiles(files) {
            const statusText = document.getElementById('statusText');
            const pContainer = document.getElementById('pContainer');
            const pBar = document.getElementById('pBar');
            const originalText = '‡∏Ñ‡∏•‡∏¥‡∏Å, ‡∏•‡∏≤‡∏Å‡∏ß‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠ <span class="text-blue-400 bg-blue-500/10 px-1 rounded">Ctrl+V</span>';

            try {
                pContainer.classList.remove('hidden');
                let totalFiles = files.length;
                let processedCount = 0;

                for (let file of files) {
                // --- 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡πÑ‡∏ü‡∏•‡πå‡∏ã‡πâ‡∏≥ (Duplicate Check) ---
                const isDuplicate = filesArray.some(existing => 
                    existing.file.name === file.name && 
                    existing.file.size === file.size
                );

                if (isDuplicate) {
                    console.log(`‚ùå ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏ã‡πâ‡∏≥: ${file.name}`);
                    continue; 
                }

                // ‡πÅ‡∏¢‡∏Å‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏ü‡∏•‡πå
                const parts = file.name.split('.');
                const ext = parts.length > 1 ? parts.pop().toLowerCase() : '';
                statusText.innerHTML = `<span class="text-blue-400 animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•: ${file.name}</span>`;

                // --- ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 1: ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏£‡∏∞‡∏Å‡∏π‡∏• ZIP & Office (‡πÅ‡∏ï‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏£‡∏π‡∏õ‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô) ---
                // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: ZIP, Word, Excel, PowerPoint, EPUB, CBZ, JAR, APK
                const archiveFormats = ['zip', 'docx', 'xlsx', 'pptx', 'epub', 'cbz', 'jar', 'apk'];
                
                if (archiveFormats.includes(ext) || 
                    file.type.includes('zip') || 
                    file.type.includes('wordprocessingml') || // Word
                    file.type.includes('spreadsheetml') ||    // Excel
                    file.type.includes('presentationml'))     // PowerPoint
                {
                    try {
                        const zip = await JSZip.loadAsync(file);
                        // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏∏‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô
                        const entries = Object.keys(zip.files).filter(name => 
                            !zip.files[name].dir && 
                            name.match(/\.(jpg|jpeg|png|webp|gif|bmp|svg|ico)$/i)
                        );

                        for (let j = 0; j < entries.length; j++) {
                            const blob = await zip.files[entries[j]].async('blob');
                            // ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö + ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏π‡∏õ‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô
                            const safeName = `${file.name}_${entries[j].split('/').pop()}`;
                            const newFile = new File([blob], safeName, { type: blob.type });
                            await processSingleFile(newFile);
                            pBar.style.width = `${((j + 1) / entries.length) * 100}%`;
                        }
                    } catch (err) {
                        console.warn("‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå ZIP/Office ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", err);
                    }
                } 
                // --- ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 2: ‡πÑ‡∏ü‡∏•‡πå PDF (‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ) ---
                else if (ext === 'pdf' || file.type === 'application/pdf') {
                    try {
                        const arrayBuffer = await file.arrayBuffer();
                        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                        for (let i = 1; i <= pdf.numPages; i++) {
                            statusText.innerHTML = `<span class="text-blue-400">PDF PAGE: ${i}/${pdf.numPages}</span>`;
                            const page = await pdf.getPage(i);
                            const viewport = page.getViewport({ scale: 1.5 });
                            const canvas = document.createElement('canvas');
                            const context = canvas.getContext('2d');
                            canvas.height = viewport.height;
                            canvas.width = viewport.width;
                            await page.render({ canvasContext: context, viewport: viewport }).promise;
                            const blob = await new Promise(r => canvas.toBlob(r, 'image/jpeg', 0.9));
                            const newFile = new File([blob], `${file.name.replace('.pdf','')}_p${i}.jpg`, { type: 'image/jpeg' });
                            await processSingleFile(newFile);
                            pBar.style.width = `${(i / pdf.numPages) * 100}%`;
                        }
                    } catch (err) {
                        console.warn("‡∏≠‡πà‡∏≤‡∏ô PDF ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ:", err);
                    }
                } 
                // --- ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà 3: ‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏£‡∏á‡πÜ) ---
                else {
                    // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JPG, PNG, WEBP, GIF, BMP, SVG, ICO
                    if (file.type.startsWith("image/") || ['jpg','jpeg','png','webp','gif','bmp','svg','ico'].includes(ext)) {
                        await processSingleFile(file);
                    } else {
                        console.warn("‚ùå ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö:", file.name);
                        // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á continue ‡∏Å‡πá‡πÑ‡∏î‡πâ ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ)
                    }
                }

                processedCount++;
                pBar.style.width = `${(processedCount / totalFiles) * 100}%`;
            }
            } catch (e) {
                console.error(e);
                alert("Error: " + e.message);
            } finally {
                setTimeout(() => {
                    pContainer.classList.add('hidden');
                    pBar.style.width = '0%';
                    statusText.innerHTML = originalText;
                    
                    // Reset input ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏Å‡∏£‡∏ì‡∏µ‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏¢‡∏≤‡∏Å‡∏•‡∏á‡πÉ‡∏´‡∏°‡πà)
                    document.getElementById('fileInput').value = '';
                    
                    render();
                }, 800);
            }
        }

        async function processSingleFile(file) {
            // --- 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡πÑ‡∏ü‡∏•‡πå‡∏ã‡πâ‡∏≥ (Duplicate Check) ---
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            const isDuplicate = filesArray.some(item => 
                item.file.name === file.name && 
                item.file.size === file.size
            );

            if (isDuplicate) {
                console.log(`‚ùå ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏ã‡πâ‡∏≥: ${file.name}`);
                return; // ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏î‡∏≥‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô)
            }

            // --- 2. ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ---
            // ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô loadImage ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏µ‡πâ (‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô)
            let img;
            try {
                img = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const i = new Image();
                        i.onload = () => resolve(i);
                        i.onerror = () => resolve(null); // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏™‡∏µ‡∏¢ ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á null
                        i.src = e.target.result;
                    };
                    reader.onerror = () => resolve(null);
                    reader.readAsDataURL(file);
                });
            } catch (err) { img = null; }

            // --- 3. ‡∏Å‡∏±‡∏ô‡∏à‡∏≠‡∏î‡∏≥ (Black Screen Prevention) ---
            if (!img) {
                console.error(`‚ö†Ô∏è ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢/‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ${file.name}`);
                return; // ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
            }

            // --- 4. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (Add to List) ---
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á ID ‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            const uniqueId = 'f-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
            
            filesArray.push({
                id: uniqueId, // ID ‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ
                file: file,
                img: img,
                isImage: true,
                extension: file.name.split('.').pop().toLowerCase(),
                mimeType: file.type,
                thumb: img.src // ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏õ‡πá‡∏ô thumb ‡πÄ‡∏•‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå
            });
        }

        function getSmartName(item, index, baseText, mode) {
            const originalName = item.file.name.replace(/\.[^/.]+$/, "");
            if (!baseText) return originalName; 
            if (mode === 'replace') return `${baseText}_${index + 1}`;
            else if (mode === 'prefix') return `${baseText}${originalName}`;
            else if (mode === 'suffix') return `${originalName}${baseText}`;
            return originalName;
        }

        function render() {
            const scrollPos = window.pageYOffset || document.documentElement.scrollTop;
            const list = document.getElementById('fileList');
            const grid = document.getElementById('resultGrid');
            
            list.innerHTML = '';
            grid.innerHTML = '';

            // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡πà‡∏≤ Ext
            const formatEl = document.getElementById('outputFormat') || document.getElementById('saveFormat'); 
            const formatVal = formatEl ? formatEl.value : 'image/jpeg';
            const outputExt = formatVal.split('/')[1].replace('jpeg', 'jpg');

            const emptyState = document.getElementById('emptyState');
            if (filesArray.length === 0) {
                if(emptyState) emptyState.style.display = 'flex';
                grid.style.display = 'none';
                document.getElementById('count').innerText = "0 FILES";
                return;
            } else {
                if(emptyState) emptyState.style.display = 'none';
                grid.style.display = 'grid';
            }

            // --- 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ã‡πâ‡∏≥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô (Pre-scan) ---
            const totalNameCounts = {};
            filesArray.forEach(item => {
                totalNameCounts[item.file.name] = (totalNameCounts[item.file.name] || 0) + 1;
            });

            // --- 2. ‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ô‡πÄ‡∏•‡∏Ç (Running Counter) ---
            const currentNameCounts = {}; 

            filesArray.forEach((item, index) => {
                const idx = index + 1;
                const originalFilename = item.file.name;
                
                // ‡πÅ‡∏¢‡∏Å‡∏ä‡∏∑‡πà‡∏≠ ‡∏Å‡∏±‡∏ö ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•
                let lastDot = originalFilename.lastIndexOf('.');
                let baseName = lastDot > 0 ? originalFilename.substring(0, lastDot) : originalFilename;
                let ext = lastDot > 0 ? originalFilename.substring(lastDot) : '';

                // --- ‡∏•‡∏≠‡∏à‡∏¥‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏ä‡∏ß‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ ---
                let displayName = baseName;

                // ‡∏ñ‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ã‡πâ‡∏≥‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏£‡∏π‡∏õ ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ -> ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏•‡∏Ç‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏™‡∏°‡∏≠ (_1, _2, _3)
                if (totalNameCounts[originalFilename] > 1) {
                    // ‡∏ö‡∏ß‡∏Å‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏•‡∏∞ 1 ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á
                    currentNameCounts[originalFilename] = (currentNameCounts[originalFilename] || 0) + 1;
                    
                    // ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô ‡∏ä‡∏∑‡πà‡∏≠_1, ‡∏ä‡∏∑‡πà‡∏≠_2
                    displayName = `${baseName}_${currentNameCounts[originalFilename]}`;
                }

                const fullName = `${displayName}.${outputExt}`;

                // 1. ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ (List)
                const li = document.createElement('div');
                li.className = 'flex items-center gap-2 bg-slate-900/50 p-2 rounded border border-slate-700 hover:border-blue-500 transition-colors group cursor-move';
                li.innerHTML = `
                    <span class="text-slate-600 cursor-grab">‚ò∞</span>
                    <span class="text-blue-500 font-bold font-numeric w-4 mt-0.5 text-center">${idx}</span>
                    <div class="w-8 h-8 flex-shrink-0 rounded overflow-hidden bg-slate-800 flex items-center justify-center cursor-pointer" onclick="openLarge('${item.id}', 'source')">
                        <img src="${item.thumb}" class="w-full h-full object-cover">
                    </div>
                    <span id="list-label-${item.id}" class="break-all flex-1 ml-1 text-[10px] leading-tight text-white font-thai">${fullName}</span>
                    <button onclick="removeFile('${item.id}')" class="text-slate-600 hover:text-red-500 px-1 font-bold">‚úï</button>
                `;
                list.appendChild(li);

                // 2. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Grid
                const cont = document.createElement('div');
                cont.className = 'canvas-container relative group';
                cont.innerHTML = `
                    <div class="relative bg-black group overflow-hidden rounded-t-lg">
                        <canvas id="canvas-${item.id}" class="w-full h-auto block cursor-pointer" onclick="openLarge('${item.id}')"></canvas>
                        
                        <div id="search-data-${item.id}" class="search-data" style="position: fixed; top: -9999px; left: -9999px; width: 1px; height: 1px; overflow: hidden; white-space: nowrap;">
                            ${item.file.name} ${fullName}
                        </div>

                        <div class="absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="downloadSingle('${item.id}'); playSuccess()" class="bg-blue-600/90 text-[10px] text-white px-2 py-1 rounded font-bold font-thai hover:bg-blue-500 transition-all">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                            <button onclick="openLarge('${item.id}', 'source'); playClick()" class="bg-slate-700/90 text-[10px] text-white px-2 py-1 rounded font-bold font-thai hover:bg-slate-600 transition-all">‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö</button>
                        </div>
                    </div>
                    <div class="p-3 bg-black/50 backdrop-blur-md border border-t-0 border-white/5 rounded-b-lg">
                        <div id="grid-label-${item.id}" class="text-[10px] font-bold text-blue-400 break-all leading-tight mb-1 font-thai">${fullName}</div>
                        <div class="flex justify-between items-center text-[8px] text-slate-500 font-numeric">
                            <span>ORIG: ${item.img.naturalWidth}x${item.img.naturalHeight}</span>
                            <span id="res-label-${item.id}">...</span>
                        </div>
                    </div>
                `;
                grid.appendChild(cont);
                
                // ‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏•‡∏á‡∏à‡∏≠
                setTimeout(() => {
                    if(typeof drawCanvas === 'function') drawCanvas(item);
                }, 0);
            });

            if(typeof initSortable === 'function') initSortable();
            window.scrollTo(0, scrollPos);
            document.getElementById('count').innerText = `${filesArray.length} FILES`;

            requestAnimationFrame(() => {
                if(typeof updateAll === 'function') updateAll(); 
            });
        }

        // =========================================================
        // üöÄ FINAL PATCH: ‡πÅ‡∏Å‡πâ‡∏Ñ‡πâ‡∏≤‡∏á + ‡πÅ‡∏Å‡πâ Ctrl+F + ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ List/Grid
        // (‡πÉ‡∏´‡πâ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏ó‡∏±‡∏ö function handleRename ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)
        // =========================================================

        // 1. ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏™‡∏∏‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡πÑ‡∏î‡πâ)
        var renameBatchId = null;       // ‡πÄ‡∏Å‡πá‡∏ö ID ‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠
        var renameDebounceTimer = null; // ‡πÄ‡∏Å‡πá‡∏ö ID ‡∏á‡∏≤‡∏ô‡∏ß‡∏≤‡∏î‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥

        // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠ (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á)
        window.updateTextOnly = function() {
            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏£‡∏±‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡∏™‡∏±‡πà‡∏á‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡πà‡∏≠‡∏ô
            if (renameBatchId) {
                cancelAnimationFrame(renameBatchId);
            }

        // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á Input
        const baseName = document.getElementById('newName')?.value || ""; 
        const renameMode = document.getElementById('renameMode')?.value || "replace";
        
        // ‡∏î‡∏∂‡∏á‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        const formatEl = document.getElementById('outputFormat') || document.getElementById('saveFormat');
        const outputExt = (formatEl ? formatEl.value : 'image/jpeg').split('/')[1].replace('jpeg', 'jpg');
        
        const totalFiles = filesArray.length;
        let i = 0;
        const batchSize = 50; // ‡∏ó‡∏≥‡∏ó‡∏µ‡∏•‡∏∞ 50 ‡πÑ‡∏ü‡∏•‡πå (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏µ ‡πÑ‡∏°‡πà‡∏Ñ‡πâ‡∏≤‡∏á)

        function runBatch() {
            const limit = Math.min(i + batchSize, totalFiles);
            
            for (; i < limit; i++) {
                const item = filesArray[i];
                if (!item) continue;

                // --- A. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà ---
                let oldName = item.file.name;
                // ‡∏ï‡∏±‡∏î‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏≠‡∏Å (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà‡∏ä‡∏∑‡πà‡∏≠)
                let namePart = oldName.lastIndexOf('.') !== -1 ? oldName.substring(0, oldName.lastIndexOf('.')) : oldName;
                let smartName = namePart;

                if (renameMode === 'replace') {
                    smartName = baseName || namePart;

                    // ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏µ {n} ‡πÉ‡∏´‡πâ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
                    if (smartName.includes('{n}')) {
                        smartName = smartName.replace(/{n}/g, (i + 1).toString().padStart(3, '0'));
                    } else {
                        // [‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà] ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ {n} ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏¥‡∏° _‡πÄ‡∏•‡∏Ç‡∏•‡∏≥‡∏î‡∏±‡∏ö ‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏™‡∏°‡∏≠
                        // ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô: ‡∏ä‡∏∑‡πà‡∏≠_1, ‡∏ä‡∏∑‡πà‡∏≠_2, ‡∏ä‡∏∑‡πà‡∏≠_3
                        smartName = `${smartName}_${i + 1}`;
                    }
                }
                                
                item.smartName = smartName; // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤
                const fullName = `${smartName}.${outputExt}`; // ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏ß‡∏°‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•

                // --- B. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (DOM) ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î ---
                
                // 1. ‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (List View)
                const listLabel = document.getElementById(`list-label-${item.id}`);
                if (listLabel) listLabel.innerText = fullName;
                
                // 2. ‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á (Grid View)
                const gridLabel = document.getElementById(`grid-label-${item.id}`);
                if (gridLabel) gridLabel.innerText = fullName;

                // 3. ‚≠êÔ∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÅ‡∏Å‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Ctrl+F (Search Data)
                const searchData = document.getElementById(`search-data-${item.id}`);
                if (searchData) {
                    // ‡πÉ‡∏™‡πà‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πà‡∏≤ ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏à‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    searchData.innerText = `${item.file.name} ${fullName} ${smartName}`;
                }
            }

            // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö ‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏≥‡∏ï‡πà‡∏≠‡πÄ‡∏ü‡∏£‡∏°‡∏´‡∏ô‡πâ‡∏≤
            if (i < totalFiles) {
                renameBatchId = requestAnimationFrame(runBatch);
            } else {
                renameBatchId = null; 
            }
        }
        
        runBatch(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    };

    // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å (Main Switch) - ‡∏ï‡∏±‡∏ß‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ
    window.handleRename = function() {
        // ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å)
        updateTextOnly(); 
        
        // ‡∏™‡∏±‡πà‡∏á‡∏ß‡∏≤‡∏î‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥ (Canvas) ‡πÇ‡∏î‡∏¢‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 0.5 ‡∏ß‡∏¥ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏≤‡∏á)
        if (typeof watermarkMode !== 'undefined' && watermarkMode === 'filename') {
            clearTimeout(renameDebounceTimer);
            renameDebounceTimer = setTimeout(() => {
                if(typeof updateAll === 'function') {
                    console.log("Rendering Watermarks...");
                    updateAll();
                }
            }, 500);
        }
    };

        function toggleWM() {
            const toggle = document.getElementById('wmToggle');
            if (toggle) {
                // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ global (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
                if(typeof isWMEnabled !== 'undefined') {
                    isWMEnabled = toggle.checked; 
                }
                
                const status = document.getElementById('wmStatusText');
                if(status) status.innerText = toggle.checked ? "‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥: ‡πÄ‡∏õ‡∏¥‡∏î" : "‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥: ‡∏õ‡∏¥‡∏î";
                
                updateAllDebounced();
            }
        }

        async function downloadSingle(id) {
            const item = filesArray.find(f => f.id === id);
            if (!item) return;

            const baseName = document.getElementById('newName').value.trim();
            const renameMode = document.getElementById('renameMode').value;
            const index = filesArray.indexOf(item);
            
            const coreName = getSmartName(item, index, baseName, renameMode);
            const mimeType = document.getElementById('outputFormat').value;
            const ext = mimeType.split('/')[1].replace('jpeg', 'jpg');
            const fileName = `${coreName}.${ext}`;

            const canvas = document.getElementById(`canvas-${id}`);
            const quality = parseFloat(document.getElementById('quality').value);
            
            if ('showSaveFilePicker' in window) {
                try {
                    const handle = await window.showSaveFilePicker({
                        suggestedName: fileName,
                        types: [{ description: 'Image File', accept: {[mimeType]: [`.${ext}`]} }],
                    });
                    const writable = await handle.createWritable();
                    const blob = await new Promise(res => canvas.toBlob(res, mimeType, quality));
                    await writable.write(blob);
                    await writable.close();
                } catch (err) { console.log('Cancelled'); }
            } else {
                saveAs(canvas.toDataURL(mimeType, quality), fileName);
            }
        }

        function insertDate(targetId) {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hour = String(now.getHours()).padStart(2, '0');
            const min = String(now.getMinutes()).padStart(2, '0');
            
            const dateStr = `${year}-${month}-${day}`;
            const fullStr = `${year}-${month}-${day} ${hour}:${min}`;
            
            const input = document.getElementById(targetId);
            let currentVal = input.value;

            // [FIX] ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ã‡πâ‡∏≥
            if (targetId === 'newName') {
                // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö YYYY-MM-DD ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô
                currentVal = currentVal.replace(/\d{4}-\d{2}-\d{2}/g, '').trim();
                // ‡πÄ‡∏ï‡∏¥‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡πÑ‡∏õ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å (‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡∏ó‡πâ‡∏≤‡∏¢)
                input.value = currentVal ? `${currentVal}_${dateStr}` : dateStr;
                handleRename();
            } else {
                // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á Text ‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥
                input.value = fullStr + " " + currentVal; // ‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
                updateAll();
            }
        }

        function wrapText(ctx, text, x, y, maxWidth, lineHeight, showUnderline, fontS, showStroke) {
            // ‡πÉ‡∏ä‡πâ Intl.Segmenter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏â‡∏µ‡∏Å‡∏Ñ‡∏≥)
            const segmenter = new Intl.Segmenter('th', { granularity: 'word' });
            const words = [...segmenter.segment(text)].map(s => s.segment);

            let line = '';
            // ‡∏õ‡∏£‡∏±‡∏ö Line Height ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏™‡∏£‡∏∞‡πÑ‡∏ó‡∏¢ (1.4 - 1.5 ‡πÄ‡∏ó‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå)
            const adjustedLineHeight = fontS * 1.5; 

            for (let n = 0; n < words.length; n++) {
                const testLine = line + words[n];
                const metrics = ctx.measureText(testLine);
                const testWidth = metrics.width;

                if (testWidth > maxWidth && n > 0) {
                    if (showStroke) ctx.strokeText(line, x, y);
                    ctx.fillText(line, x, y);
                    if (showUnderline) {
                        ctx.beginPath();
                        ctx.moveTo(x - (testWidth/2), y + 5); // ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏ï‡πâ
                        ctx.lineTo(x + ctx.measureText(line).width, y + 5);
                        ctx.stroke();
                    }
                    line = words[n];
                    y += adjustedLineHeight;
                } else {
                    line = testLine;
                }
            }
            if (showStroke) ctx.strokeText(line, x, y);
            ctx.fillText(line, x, y);
            if (showUnderline) {
                ctx.beginPath();
                ctx.moveTo(x, y + 5);
                ctx.lineTo(x + ctx.measureText(line).width, y + 5);
                ctx.stroke();
            }
        }

        function drawLine(ctx, lineText, x, y, fontS) {
            const m = ctx.measureText(lineText);
            const underlineY = y + (fontS * 0.15);
            let startX = x;
            if(ctx.textAlign === 'center') startX = x - (m.width/2);
            else if(ctx.textAlign === 'right') startX = x - m.width;
            ctx.beginPath();
            ctx.lineWidth = fontS * 0.08;
            ctx.moveTo(startX, underlineY);
            ctx.lineTo(startX + m.width, underlineY);
            ctx.stroke();
        }

        function updateFX(type) {
            if (type === 'bright') filters.bright = document.getElementById('fxBright').value;
            if (type === 'contrast') filters.contrast = document.getElementById('fxContrast').value;
            if (type === 'gray') filters.gray = document.getElementById('fxGray').value;
            updateFXDisplay();
            updateAll();
        }

        function resetFX() {
            filters.bright = 100; filters.contrast = 100; filters.gray = 0;
            document.getElementById('fxBright').value = 100;
            document.getElementById('fxContrast').value = 100;
            document.getElementById('fxGray').value = 0;
            updateFXDisplay();
            updateAll();
        }

        function updateFXDisplay() {
            document.getElementById('val-bright').innerText = filters.bright + '%';
            document.getElementById('val-contrast').innerText = filters.contrast + '%';
            document.getElementById('val-gray').innerText = filters.gray + '%';
        }

        function toggleGradient() {
            isGradient = document.getElementById('gradientToggle').checked;
            document.getElementById('gradColorContainer').classList.toggle('hidden', !isGradient);
            updateAll();
        }

        function generateQR(text) {
            if (!text) return null;
            const qr = new QRious({ value: text, size: 500, level: 'H' });
            return qr.toDataURL();
        }

        let renderTask; 

        function updateAll() {
            if (renderTask) cancelAnimationFrame(renderTask);
            saveSettings();

            const baseName = document.getElementById('newName').value.trim();
            const renameMode = document.getElementById('renameMode').value;
            const outputFormat = document.getElementById('outputFormat').value;
            const outputExt = outputFormat.split('/')[1].replace('jpeg', 'jpg');
            
            // Feature 1: Max Width Logic
            const maxWidthInput = document.getElementById('inputMaxWidth').value;
            const maxWidth = maxWidthInput ? parseInt(maxWidthInput) : 0;

            const config = {
                size: document.getElementById('fontSize').value,
                opac: document.getElementById('opacity').value,
                color: document.getElementById('color').value,
                color2: document.getElementById('color2').value,
                rot: (document.getElementById('rotationNum').value * Math.PI) / 180,
                custom: document.getElementById('customText').value,
                qrText: document.getElementById('qrInput').value
            };

            if (watermarkMode === 'qrcode' && config.qrText) {
                const qrData = generateQR(config.qrText);
                if (qrData) {
                    qrCachedImg = new Image();
                    qrCachedImg.src = qrData;
                }
            }

            let i = 0;
            const batchSize = 10; 

            function renderBatch() {
                const limit = Math.min(i + batchSize, filesArray.length);
                for (; i < limit; i++) {
                    const item = filesArray[i];
                    if (!item.isImage) continue;

                    const canvas = document.getElementById(`canvas-${item.id}`);
                    if (!canvas) continue;

                    // Calculate Resize
                    let finalW = item.img.width;
                    let finalH = item.img.height;
                    
                    if (maxWidth > 0 && finalW > maxWidth) {
                        const ratio = maxWidth / finalW;
                        finalW = maxWidth;
                        finalH = item.img.height * ratio;
                    }

                    // Update UI Label for resolution
                    const resLabel = document.getElementById(`res-label-${item.id}`);
                    if(resLabel) resLabel.innerText = `NEW: ${Math.round(finalW)}x${Math.round(finalH)}`;

                    const ctx = canvas.getContext('2d');
                    if (canvas.width !== Math.round(finalW) || canvas.height !== Math.round(finalH)) {
                        canvas.width = Math.round(finalW);
                        canvas.height = Math.round(finalH);
                    }

                    ctx.save();
                    // --- FIX: Transparency Logic ---
                    ctx.clearRect(0, 0, canvas.width, canvas.height); // ‡∏•‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÉ‡∏™‡∏Å‡πà‡∏≠‡∏ô
                    
                    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô JPEG ‡πÉ‡∏´‡πâ‡∏ñ‡∏°‡∏Ç‡∏≤‡∏ß (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ JPEG ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÉ‡∏™)
                    if (outputFormat === 'image/jpeg') {
                        ctx.fillStyle = "#ffffff"; 
                        ctx.fillRect(0, 0, canvas.width, canvas.height);
                    }
                    // -------------------------------
                    
                    ctx.filter = `brightness(${filters.bright}%) contrast(${filters.contrast}%) grayscale(${filters.gray}%)`;
                    // Draw Image with Resize
                    ctx.drawImage(item.img, 0, 0, canvas.width, canvas.height);
                    ctx.restore(); 

                    if (isWMEnabled) {
                        ctx.save();
                        ctx.globalAlpha = config.opac;
                        
                        const fontS = (canvas.width * (config.size / 1000));
                        ctx.font = `${styles.italic ? 'italic ' : ''}${styles.bold ? 'bold ' : ''}${fontS}px Sarabun`;

                        if (styles.shadow) {
                            ctx.shadowColor = "rgba(0,0,0,0.8)";
                            ctx.shadowBlur = fontS * 0.1;
                            ctx.shadowOffsetX = fontS * 0.05;
                            ctx.shadowOffsetY = fontS * 0.05;
                        } else {
                            ctx.shadowColor = "transparent";
                        }

                        if (styles.stroke) {
                            ctx.strokeStyle = '#000000'; 
                            ctx.lineWidth = fontS * 0.03;
                            ctx.lineJoin = 'round';
                        }
                        
                        let fillStyle = config.color;
                        if (isGradient) {
                            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                            gradient.addColorStop(0, config.color);
                            gradient.addColorStop(1, config.color2);
                            fillStyle = gradient;
                        }
                        ctx.fillStyle = fillStyle;

                        let activeImg = null;
                        let text = "";

                        if (watermarkMode === 'logo') activeImg = watermarkLogo;
                        else if (watermarkMode === 'qrcode') activeImg = qrCachedImg;
                        else text = (watermarkMode === 'filename') ? getSmartName(item, i, baseName, renameMode) : config.custom;

                        if (styles.tile) {
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            // [FIX] ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 50px ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Loop ‡∏ô‡∏£‡∏Å‡∏à‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏≤‡∏á
                            const stepY = Math.max(fontS * 6, 50); 
                            const tileRot = -25 * Math.PI / 180;
                            let contentW = fontS * 4; 
                            if (activeImg) contentW = (canvas.width * (config.size / 500));
                            else contentW = ctx.measureText(text).width;
                            
                            // [FIX] ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ 50px ‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô
                            const stepX = Math.max(contentW + (canvas.width * 0.2), 50);

                            // [OPTIMIZE] ‡∏•‡∏î‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï Loop ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ß‡∏≤‡∏î‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏≤‡∏Å‡πÑ‡∏õ
                            for (let ty = -canvas.height; ty < canvas.height * 2; ty += stepY) {
                                for (let tx = -canvas.width; tx < canvas.width * 2; tx += stepX) {
                                    // ... (‡πÇ‡∏Ñ‡πâ‡∏î‡∏ß‡∏≤‡∏î‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ...
                                    ctx.save();
                                    let finalX = tx;
                                    if ((Math.floor(ty / stepY)) % 2 !== 0) finalX += stepX / 2;
                                    ctx.translate(finalX, ty);
                                    ctx.rotate(tileRot);
                                    
                                    if (activeImg) {
                                        const lW = (canvas.width * (config.size / 500));
                                        const lH = (lW * activeImg.height) / activeImg.width;
                                        ctx.drawImage(activeImg, -lW/2, -lH/2, lW, lH);
                                    } else {
                                        if (styles.stroke) ctx.strokeText(text, 0, 0);
                                        ctx.fillText(text, 0, 0);
                                    }
                                    ctx.restore();
                                }
                            }
                        } else {
                            let x = canvas.width/2, y = canvas.height/2;
                            if (currentPos.startsWith('t')) y = fontS * 1.5;
                            else if (currentPos.startsWith('b')) y = canvas.height - (fontS * 1.5);
                            
                            if (currentPos.endsWith('l')) { x = fontS; ctx.textAlign = 'left'; }
                            else if (currentPos.endsWith('r')) { x = canvas.width - fontS; ctx.textAlign = 'right'; }
                            else { ctx.textAlign = 'center'; }

                            ctx.translate(x, y);
                            ctx.rotate(config.rot);
                            
                            if (activeImg) {
                                const lW = (canvas.width * (config.size / 500));
                                const lH = (lW * activeImg.height) / activeImg.width;
                                ctx.drawImage(activeImg, -lW/2, -lH/2, lW, lH);
                            } else {
                                const maxWidth = canvas.width * 0.8; 
                                const lineHeight = fontS * 1.2;
                                if (isGradient) {
                                    const grad = ctx.createLinearGradient(0, -fontS, 0, fontS);
                                    grad.addColorStop(0, config.color);
                                    grad.addColorStop(1, config.color2);
                                    ctx.fillStyle = grad;
                                }
                                wrapText(ctx, text, 0, 0, maxWidth, lineHeight, styles.underline, fontS, styles.stroke);
                            }
                        }
                        ctx.restore();
                    }
                }
                if (i < filesArray.length) {
                    renderTask = requestAnimationFrame(renderBatch);
                }
            }
            renderBatch();
        }

        async function downloadAll() {
            if (filesArray.length === 0) return alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î");
            
            // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Dropdown ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠ id="saveFormat" ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö)
            const formatEl = document.getElementById('saveFormat');
            // ‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤ Default ‡πÄ‡∏õ‡πá‡∏ô JPEG
            const format = formatEl ? formatEl.value : 'image/jpeg';
            
            const statusText = document.getElementById('statusText');
            const originalText = statusText.innerHTML;

            statusText.innerHTML = '<span class="text-green-400 animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</span>';

            try {
                // --- ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô PowerPoint (.pptx) ---
                if (format === 'application/pptx') {
                    const pres = new PptxGenJS();
                    for (let item of filesArray) {
                        const slide = pres.addSlide();
                        // ‡πÄ‡∏≠‡∏≤‡∏£‡∏π‡∏õ‡∏ß‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏™‡πÑ‡∏•‡∏î‡πå (‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
                        slide.addImage({ 
                            data: item.img.src, 
                            x: "10%", y: "10%", w: "80%", h: "80%", 
                            sizing: { type: "contain", w: "80%", h: "80%" } 
                        });
                    }
                    await pres.writeFile({ fileName: `LinkStart_Slide_${Date.now()}.pptx` });
                }
                
                // --- ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô Word (.docx) ---
                else if (format === 'application/docx') {
                    const docChildren = [];
                    
                    for (let item of filesArray) {
                        // ‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏π‡∏õ‡πÄ‡∏õ‡πá‡∏ô Buffer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡πÉ‡∏ô Word
                        const resp = await fetch(item.img.src);
                        const blob = await resp.blob();
                        const buffer = await blob.arrayBuffer();

                        docChildren.push(
                            new docx.Paragraph({
                                children: [
                                    new docx.ImageRun({
                                        data: buffer,
                                        transformation: { width: 500, height: 500 * (item.img.naturalHeight / item.img.naturalWidth) }
                                    })
                                ]
                            })
                        );
                        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢)
                        if (item !== filesArray[filesArray.length - 1]) {
                            docChildren.push(new docx.Paragraph({ children: [new docx.PageBreak()] }));
                        }
                    }

                    const doc = new docx.Document({ sections: [{ children: docChildren }] });
                    const blob = await docx.Packer.toBlob(doc);
                    saveAs(blob, `LinkStart_Doc_${Date.now()}.docx`);
                }

                // --- ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà 3: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (ZIP) ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πä‡∏∞‡πÜ ---
                else {
                    const zip = new JSZip();
                    const ext = format.split('/')[1].replace('jpeg', 'jpg');
                    
                    // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö (Counter) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠
                    // ‡πÄ‡∏ä‡πà‡∏ô { "123": 0, "‡∏†‡∏≤‡∏û‡∏á‡∏≤‡∏ô": 0 }
                    const nameCountMap = {};

                    // 2. ‡πÅ‡∏≠‡∏ö‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏ß‡∏°‡∏Å‡πà‡∏≠‡∏ô (Pre-scan) ‡∏ß‡πà‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå
                    // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏´‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏•‡∏Ç _1, _2 ‡∏ö‡πâ‡∏≤‡∏á
                    const totalNameCounts = {};
                    filesArray.forEach(item => {
                        let fName = document.getElementById('grid-label-' + item.id).innerText;
                        if (fName.lastIndexOf('.') > 0) fName = fName.substring(0, fName.lastIndexOf('.'));
                        fName = fName.trim(); // ‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å
                        totalNameCounts[fName] = (totalNameCounts[fName] || 0) + 1;
                    });

                    // 3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÑ‡∏ü‡∏•‡πå "‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÑ‡∏ß‡πâ"
                    for (let i = 0; i < filesArray.length; i++) {
                        const item = filesArray[i];
                        
                        // ‡∏î‡∏∂‡∏á‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥/‡πÅ‡∏ï‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß)
                        let sourceCanvas = document.getElementById(`canvas-${item.id}`);
                        if (!sourceCanvas) {
                             // ‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß: ‡∏ñ‡πâ‡∏≤‡∏´‡∏≤ Canvas ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°
                             sourceCanvas = document.createElement('canvas');
                             sourceCanvas.width = item.img.naturalWidth;
                             sourceCanvas.height = item.img.naturalHeight;
                             const ctx = sourceCanvas.getContext('2d');
                             if (format === 'image/jpeg') {
                                 ctx.fillStyle = '#FFFFFF';
                                 ctx.fillRect(0, 0, sourceCanvas.width, sourceCanvas.height);
                             }
                             ctx.drawImage(item.img, 0, 0);
                        }

                        await new Promise(resolve => {
                            sourceCanvas.toBlob((b) => {
                                // ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                                let fileName = document.getElementById('grid-label-' + item.id).innerText;
                                if (fileName.lastIndexOf('.') > 0) {
                                    fileName = fileName.substring(0, fileName.lastIndexOf('.'));
                                }
                                fileName = fileName.trim(); // ‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á

                                let finalName = fileName;

                                // --- ‡∏•‡∏≠‡∏à‡∏¥‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö (Sequential Naming) ---
                                // ‡∏ñ‡πâ‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô "‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 1 ‡∏£‡∏π‡∏õ" ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -> ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏•‡∏Ç‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡πÄ‡∏™‡∏°‡∏≠ (_1, _2, _3)
                                if (totalNameCounts[fileName] > 1) {
                                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ
                                    nameCountMap[fileName] = (nameCountMap[fileName] || 0) + 1;
                                    
                                    // ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏•‡∏Ç‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ
                                    // ‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏à‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å = _1, ‡πÄ‡∏à‡∏≠‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á = _2
                                    finalName = `${fileName}_${nameCountMap[fileName]}`;
                                }
                                // --------------------------------------------------

                                zip.file(`${finalName}.${ext}`, b);
                                resolve();
                            }, format, 0.9);
                        });
                    }
                    
                    const content = await zip.generateAsync({ type: "blob" });
                    saveAs(content, `LinkStart_Images_${Date.now()}.zip`);
                }
                
                playSuccess();

            } catch (e) {
                console.error(e);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå: " + e.message);
            } finally {
                statusText.innerHTML = originalText;
            }
        }
        
        async function downloadPDF() {
            if (filesArray.length === 0) return alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á PDF');
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ jsPDF ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© (A4)
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 10; // ‡∏Ç‡∏≠‡∏ö 10mm
            const maxWidth = pageWidth - (margin * 2);
            const maxHeight = pageHeight - (margin * 2);

            for (let i = 0; i < filesArray.length; i++) {
                const item = filesArray[i];
                if (i > 0) doc.addPage(); // ‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ

                // ‡πÉ‡∏ä‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡∏†‡∏≤‡∏û‡∏à‡∏£‡∏¥‡∏á
                const imgW = item.img.naturalWidth || item.img.width;
                const imgH = item.img.naturalHeight || item.img.height;
                const imgRatio = imgW / imgH;

                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏£‡∏≠‡∏ö (Fit Contain)
                let finalW = maxWidth;
                let finalH = maxWidth / imgRatio;

                if (finalH > maxHeight) {
                    finalH = maxHeight;
                    finalW = maxHeight * imgRatio;
                }

                // ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á
                const x = (pageWidth - finalW) / 2;
                const y = (pageHeight - finalH) / 2;

                // ‡∏ß‡∏≤‡∏î‡∏†‡∏≤‡∏û‡∏•‡∏á PDF (‡πÉ‡∏ä‡πâ Canvas ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß)
                const canvas = document.getElementById(`canvas-${item.id}`);
                if (canvas) {
                    const imgData = canvas.toDataURL('image/jpeg', 0.9);
                    doc.addImage(imgData, 'JPEG', x, y, finalW, finalH);
                }
            }
            
            doc.save(`LinkStart_PDF_${new Date().getTime()}.pdf`);
        }
        
        function loadLogo(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    watermarkLogo = new Image();
                    watermarkLogo.onload = () => { setMode('logo'); };
                    watermarkLogo.src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function syncRotation(source) {
            const num = document.getElementById('rotationNum');
            const range = document.getElementById('rotationRange');
            if (source === 'range') num.value = range.value;
            else range.value = num.value;
            if (typeof updateAll === "function") updateAll();
        }

        function updateNamesOnly() {
            const baseName = document.getElementById('newName').value.trim();
            const renameMode = document.getElementById('renameMode').value;
            const outputExt = document.getElementById('outputFormat').value.split('/')[1].replace('jpeg', 'jpg');

            filesArray.forEach((item, i) => {
                const coreName = getSmartName(item, i, baseName, renameMode);
                const fullName = `${coreName}.${outputExt}`;
                
                // ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ id="list-label-..." ‡πÅ‡∏•‡∏∞ id="grid-label-..." ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 1
                const listLabel = document.getElementById(`list-label-${item.id}`);
                const gridLabel = document.getElementById(`grid-label-${item.id}`);
                
                if(listLabel) listLabel.innerText = fullName;
                if(gridLabel) gridLabel.innerText = fullName;
            });
        }
        
        function setMode(m) { 
            watermarkMode = m; 
            document.querySelectorAll('[id^="mode-"]').forEach(b => b.classList.remove('active'));
            document.getElementById('mode-'+m).classList.add('active');
            document.getElementById('customText').classList.toggle('hidden', m !== 'custom');
            document.getElementById('customTextContainer').classList.toggle('hidden', m !== 'custom');
            document.getElementById('qrInput').classList.toggle('hidden', m !== 'qrcode');
            updateAll(); 
        }

        function toggleWM() {
            isWMEnabled = document.getElementById('wmToggle').checked;
            document.getElementById('wmStatusText').innerText = isWMEnabled ? '‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥: ‡πÄ‡∏õ‡∏¥‡∏î' : '‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥: ‡∏õ‡∏¥‡∏î';

            // ‡∏õ‡∏¥‡∏î/‡πÄ‡∏õ‡∏¥‡∏î control ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            document.getElementById('wmControls').style.opacity = isWMEnabled ? "1" : "0.4";
            document.getElementById('wmControls').style.pointerEvents = isWMEnabled ? "auto" : "none";

            updateAll();
        }


        function setPos(p) { 
            currentPos = p; 
            const posIds = ['tl', 'tc', 'tr', 'ml', 'mc', 'mr', 'bl', 'bc', 'br'];
            posIds.forEach(id => {
                const btn = document.getElementById('btn-' + id);
                if(btn) btn.classList.remove('active');
            });
            const targetBtn = document.getElementById('btn-' + p);
            if(targetBtn) targetBtn.classList.add('active'); 
            updateAll(); 
        }

        function toggleStyle(s) { 
            styles[s] = !styles[s]; 
            const btn = document.getElementById('btn-' + s);
            if (styles[s]) btn.classList.add('active');
            else btn.classList.remove('active');
            updateAll(); 
        }

        function removeFile(id) {
            // ‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå Memory
            const itemToRemove = filesArray.find(item => item.id === id);
            if (itemToRemove && itemToRemove.img && itemToRemove.img.src.startsWith("blob:")) {
                URL.revokeObjectURL(itemToRemove.img.src);
            }

            // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà ID ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö
            filesArray = filesArray.filter(item => item.id !== id);
            
            playClick(); // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            render();    // ‡∏ß‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÉ‡∏´‡∏°‡πà (‡∏ã‡∏∂‡πà‡∏á‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö Clear ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠ 1)
        }

        function clearAll() {
            filesArray.forEach(f => {
                if (f.img && f.img.src.startsWith("blob:")) {
                    URL.revokeObjectURL(f.img.src);
                }
            });
            filesArray = [];
            document.getElementById('newName').value = '';
            render();
        }

        function saveAllAuto() { downloadAll('zip'); }
        function resetSystem() { localStorage.removeItem('LinkStart_Config_V25'); location.reload(); }
        function syncInput(type) {
            if (type === 'quality') document.getElementById('inputQuality').value = Math.round(document.getElementById('quality').value * 100);
            else if (type === 'size') document.getElementById('inputSize').value = document.getElementById('fontSize').value;
            else if (type === 'opac') document.getElementById('inputOpacity').value = document.getElementById('opacity').value;
            updateAll();
        }
        function syncRange(type) {
            if (type === 'quality') document.getElementById('quality').value = document.getElementById('inputQuality').value / 100;
            else if (type === 'size') document.getElementById('fontSize').value = document.getElementById('inputSize').value;
            else if (type === 'opac') document.getElementById('opacity').value = document.getElementById('inputOpacity').value;
            updateAll();
        }

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà: ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏î‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥ (Core Engine) ---
        async function updateAll() {
            const grid = document.getElementById('resultGrid');
            const inputMaxWidth = document.getElementById('inputMaxWidth').value; // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ö‡∏µ‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á
            const renameBase = document.getElementById('newName').value.trim();
            const renameMode = document.getElementById('renameMode').value;

            for (let i = 0; i < filesArray.length; i++) {
                const item = filesArray[i];
                if (!item.img) continue;

                // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Canvas (‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ)
                let canvas = document.getElementById(`canvas-${item.id}`);
                if (!canvas) {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'relative group';
                    wrapper.innerHTML = `
                        <canvas id="canvas-${item.id}" class="w-full rounded-lg shadow-lg border border-slate-700 cursor-pointer" onclick="openLarge('${item.id}', 'result')"></canvas>
                        <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1">
                            <button onclick="removeFile('${item.id}')" class="bg-red-500 text-white p-1 rounded text-[10px]">‡∏•‡∏ö</button>
                        </div>
                    `;
                    grid.appendChild(wrapper);
                    canvas = document.getElementById(`canvas-${item.id}`);
                }

                const ctx = canvas.getContext('2d');

                // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡∏†‡∏≤‡∏û (Resize Logic)
                let w = item.img.width;
                let h = item.img.height;
                if (inputMaxWidth && w > parseInt(inputMaxWidth)) {
                    const scale = parseInt(inputMaxWidth) / w;
                    w = parseInt(inputMaxWidth);
                    h = h * scale;
                }

                canvas.width = w;
                canvas.height = h;

                // 3. ‡πÉ‡∏ä‡πâ Filter (Brightness/Contrast/Gray)
                ctx.filter = `brightness(${filters.bright}%) contrast(${filters.contrast}%) grayscale(${filters.gray}%)`;

                // 4. ‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö
                ctx.drawImage(item.img, 0, 0, w, h);
                ctx.filter = 'none'; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï filter ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥

                // 5. ‡∏ß‡∏≤‡∏î‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥ (Watermark Logic)
                if (isWMEnabled) {
                    ctx.save();
                    
                    // ‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô (Rotation)
                    const rot = parseInt(document.getElementById('rotationNum').value || 0);
                    if (rot !== 0) {
                        ctx.translate(w/2, h/2);
                        ctx.rotate((rot * Math.PI) / 180);
                        ctx.translate(-w/2, -h/2);
                    }

                    // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ß‡∏≤‡∏î
                    let text = "";
                    if (watermarkMode === 'filename') {
                        // ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
                        text = getSmartName(item, i, renameBase, renameMode); 
                    } else if (watermarkMode === 'custom') {
                        text = document.getElementById('customText').value || "Link Start";
                    } else if (watermarkMode === 'qrcode') {
                        // ‡∏™‡πà‡∏ß‡∏ô QR Code (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                        const qrText = document.getElementById('qrInput').value || window.location.href;
                        if (!qrCachedImg || qrCachedImg.dataset.text !== qrText) {
                        const qr = new QRious({ value: qrText, size: 500 });
                        qrCachedImg = new Image();
                        qrCachedImg.src = qr.toDataURL();
                        qrCachedImg.dataset.text = qrText;
                        }
                    }

                    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Font ‡πÅ‡∏•‡∏∞ Style
                    const fontSize = parseInt(document.getElementById('fontSize').value || 80);
                    const opacity = parseFloat(document.getElementById('opacity').value || 0.5);
                    ctx.globalAlpha = opacity;

                    // ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (Position)
                    let x = w / 2, y = h / 2;
                    const pad = w * 0.05; // padding 5%
                    
                    if (currentPos.includes('l')) x = pad;
                    if (currentPos.includes('c')) x = w / 2;
                    if (currentPos.includes('r')) x = w - pad;
                    if (currentPos.includes('t')) y = pad + (fontSize/2); // ‡πÅ‡∏Å‡πâ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏Å‡∏ô Y ‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ text
                    if (currentPos.includes('m')) y = h / 2;
                    if (currentPos.includes('b')) y = h - pad;

                    // ‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏°‡πÇ‡∏´‡∏°‡∏î
                    if (watermarkMode === 'logo' && watermarkLogo) {
                        // ‡∏ß‡∏≤‡∏î Logo
                        const logoW = (watermarkLogo.width / watermarkLogo.height) * fontSize * 2;
                        const logoH = fontSize * 2;
                        ctx.drawImage(watermarkLogo, x - logoW/2, y - logoH/2, logoW, logoH);
                    } else if (watermarkMode === 'qrcode' && qrCachedImg) {
                        // ‡∏ß‡∏≤‡∏î QR
                        const qrSize = fontSize * 3;
                        ctx.drawImage(qrCachedImg, x - qrSize/2, y - qrSize/2, qrSize, qrSize);
                    } else {
                        // ‡∏ß‡∏≤‡∏î Text
                        ctx.font = `${styles.bold ? '900' : '400'} ${styles.italic ? 'italic' : ''} ${fontSize}px 'Sarabun', sans-serif`;
                        ctx.textAlign = currentPos.includes('l') ? 'left' : (currentPos.includes('r') ? 'right' : 'center');
                        ctx.textBaseline = 'middle';

                        // Shadow
                        if (styles.shadow) {
                            ctx.shadowColor = "rgba(0,0,0,0.8)";
                            ctx.shadowBlur = 10;
                            ctx.shadowOffsetX = 4;
                            ctx.shadowOffsetY = 4;
                        }

                        // Stroke (‡∏Ç‡∏≠‡∏ö)
                        if (styles.stroke) {
                            ctx.lineWidth = fontSize * 0.05;
                            ctx.strokeStyle = "black";
                            ctx.strokeText(text, x, y);
                        }

                        // Fill Color (‡∏™‡∏µ)
                        if (isGradient) {
                            const gradient = ctx.createLinearGradient(x - w/4, 0, x + w/4, 0);
                            gradient.addColorStop(0, document.getElementById('color').value);
                            gradient.addColorStop(1, document.getElementById('color2').value);
                            ctx.fillStyle = gradient;
                        } else {
                            ctx.fillStyle = document.getElementById('color').value;
                        }
                        
                        ctx.fillText(text, x, y);
                    }
                    
                    ctx.restore();
                }
            }
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡πÑ‡∏ü‡∏•‡πå (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢)
        function removeFile(id) {
            filesArray = filesArray.filter(f => f.id !== id);
            // ‡∏•‡∏ö Element ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            const li = document.getElementById(`list-label-${id}`)?.parentNode;
            const cvs = document.getElementById(`canvas-${id}`)?.parentNode;
            if(li) li.remove();
            if(cvs) cvs.remove();
            
            render(); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï index
            document.getElementById('count').innerText = `${filesArray.length} FILES`;
            if(filesArray.length === 0) {
                document.getElementById('resultGrid').style.display = 'none';
                document.getElementById('emptyState').style.display = 'flex';
            }
        }

    </script>

    <style>
        :root { 
            --k-blue: #00d2ff; 
            --k-neon: #00f2ff; 
            --bg: #020617; 
            --card: rgba(15, 23, 42, 0.8); 
            --text: #e2e8f0; 
            --border: rgba(0, 210, 255, 0.3);
            --input-bg: rgba(15, 23, 42, 0.6);
        }
        body.theme-pure-dark { --bg: #000000; --card: rgba(20, 20, 20, 0.9); --border: rgba(255, 255, 255, 0.1); --text: #ffffff; --input-bg: #111111; }
        body.theme-light { --bg: #f8fafc; --card: #ffffff; --border: #cbd5e1; --text: #1e293b; --k-blue: #0ea5e9; --input-bg: #ffffff; }

        body { font-family: 'Sarabun', sans-serif; background-color: var(--bg); color: var(--text); transition: 0.3s; overflow-x: hidden; }
        .bg-grid { 
            background-image: linear-gradient(rgba(2, 6, 23, 0.65), rgba(2, 6, 23, 0.65)), url('https://img2.pic.in.th/17370.md.jpg'); 
            background-size: cover; background-position: top center; background-repeat: no-repeat; background-attachment: fixed;
        }
        body.has-custom-bg .bg-grid { background-image: none !important; }
        body.has-custom-bg { background-image: var(--user-bg-url) !important; background-size: cover !important; background-position: center !important; background-attachment: fixed !important; background-repeat: no-repeat !important; }
        body.has-custom-bg::before { content: ""; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.4); z-index: -1; }

        /* NEW: Matrix BG Styling */
        #matrix-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            display: block; opacity: 0.8;
        }

        .font-numeric { font-family: 'Orbitron', sans-serif; }
        .font-thai { font-family: 'Sarabun', sans-serif; }
        
        input[type="text"], textarea, input[type="number"], select {
            background: var(--input-bg) !important; border: 1px solid var(--border) !important; color: var(--k-blue) !important;
            border-radius: 8px; padding: 8px 12px; outline: none; transition: all 0.4s; font-family: 'Sarabun', sans-serif;
        }
        input[type="number"] { padding: 8px 2px !important; text-align: center; width: 75px !important; }
        
        input:focus, textarea:focus { border-color: var(--k-blue) !important; box-shadow: 0 0 15px rgba(0, 210, 255, 0.3); }

        #modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 999; display: none; align-items: center; justify-content: center; backdrop-filter: blur(20px); }
        #modal.active { display: flex; }
        #modal img { max-width: 90%; max-height: 85vh; border: 2px solid var(--k-blue); box-shadow: 0 0 50px var(--k-blue); border-radius: 10px; cursor: grab; }

        .kirito-card { background: var(--card); border: 1px solid var(--border); backdrop-filter: blur(10px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); }

        .btn-action { 
            background: rgba(0, 210, 255, 0.1); border: 1px solid var(--k-blue); color: var(--k-blue); 
            transition: 0.3s; font-family: 'Orbitron'; font-weight: bold; cursor: pointer; padding: 8px 15px; border-radius: 5px;
            display: inline-flex; flex-direction: column; align-items: center; justify-content: center; min-width: 10px;
        }
        .btn-action:hover { background: var(--k-blue); color: black; box-shadow: 0 0 15px var(--k-blue); transform: scale(1.05); }
        .btn-action.active { background: var(--k-blue) !important; color: black !important; }
        .btn-action b, .btn-action em, .btn-action u { font-size: 1.1rem; margin-bottom: 1px; }

        .canvas-container { 
            position: relative; border: 2px dashed var(--border) !important; background: rgba(0,0,0,0.5); border-radius: 16px; overflow: hidden; 
            display: inline-block; width: fit-content; height: fit-content; max-width: 100%; transition: all 0.3s ease;
        }
        .canvas-container:hover { border-color: var(--k-blue) !important; box-shadow: 0 0 20px rgba(0, 210, 255, 0.2); transform: translateY(-2px); }

        #dropZone.border-blue-500 { background: rgba(0, 210, 255, 0.1); box-shadow: inset 0 0 20px rgba(0, 210, 255, 0.2); }
        
        .color-picker-wrapper { 
            position: relative; height: 45px; width: 100%; overflow: hidden; border-radius: 8px; border: 1px solid var(--border); 
            background: #ffffff !important; 
            transition: 0.3s; 
            display: flex; align-items: center; justify-content: center;
        }
        .color-picker-wrapper:hover { border-color: var(--k-blue); box-shadow: 0 0 10px rgba(0, 210, 255, 0.3); }
        input[type="color"] { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            padding: 0; border: none; width: 200%; height: 200%; cursor: pointer; 
        }

        .progress-container { width: 100%; background: rgba(15, 23, 42, 0.8); border: 1px solid var(--border); border-radius: 4px; height: 8px; margin-top: 10px; overflow: hidden; }
        .progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, var(--k-blue), var(--k-neon)); transition: width 0.3s ease; }

        .dropdown-sci {
            width: 100%; font-family: 'Sarabun', sans-serif; font-size: 10px; font-weight: bold;
            color: var(--k-blue); background-color: rgba(15, 23, 42, 0.5); border: 1px solid rgba(51, 65, 85, 1);
            border-radius: 0.5rem; padding: 0.5rem 0.75rem; outline: none; cursor: pointer; transition: all 0.3s;
        }
        .dropdown-sci:hover, .dropdown-sci:focus { border-color: var(--k-blue); background-color: rgba(15, 23, 42, 0.8); }
        .dropdown-sci option { background-color: #020617; color: var(--k-blue); padding: 10px; }

        @keyframes neon-pulse {
            0%, 100% { text-shadow: 0 0 5px rgba(0, 210, 255, 0.5), 0 0 10px rgba(0, 210, 255, 0.3); }
            50% { text-shadow: 0 0 20px rgba(0, 210, 255, 1), 0 0 30px rgba(0, 210, 255, 0.8), 0 0 40px rgba(0, 210, 255, 0.6); }
        }
        .neon-alive { animation: neon-pulse 3s infinite alternate; }
    </style>

<script>
    // ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Service Worker ‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡πá‡∏û‡∏≠‡∏Ñ‡∏£‡∏±‡∏ö (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏±‡∏ô‡∏£‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô ‡∏Ñ‡πà‡∏≠‡∏¢‡∏ó‡∏≥‡∏á‡∏≤‡∏ô)
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('‚úÖ Service Worker Registered!', reg))
                .catch(err => console.error('‚ùå SW Failed:', err));
        });
    }
</script>

<a href="https://prthachnu999.github.io/My-Personal-Space/" class="portal-back-btn">
    <span style="font-size: 1.2em;">‚Üê</span> Home
</a>

<style>
    .portal-back-btn {
        position: fixed;
        bottom: 15px;       /* ‡∏Ç‡∏¢‡∏±‡∏ö‡∏•‡∏á‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô */
        left: 15px;         /* ‡∏Ç‡∏¢‡∏±‡∏ö‡∏°‡∏≤‡∏ä‡∏¥‡∏î‡∏ã‡πâ‡∏≤‡∏¢‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô */
        z-index: 9999;
        
        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ */
        background-color: rgba(0, 0, 0, 0.6); /* ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏∂‡∏ö‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
        color: #cccccc;      /* ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÄ‡∏ó‡∏≤‡∏à‡∏≤‡∏á‡πÜ ‡πÑ‡∏°‡πà‡πÅ‡∏¢‡πà‡∏á‡∏™‡∏≤‡∏¢‡∏ï‡∏≤ */
        padding: 5px 12px;   /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏∏‡πà‡∏° (‡∏ö‡∏ô‡∏•‡πà‡∏≤‡∏á 5px, ‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏ß‡∏≤ 12px) */
        font-size: 0.85rem;  /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ */
        
        border: 1px solid rgba(255, 255, 255, 0.3); /* ‡∏Ç‡∏≠‡∏ö‡∏ö‡∏≤‡∏á‡∏•‡∏á */
        border-radius: 20px;
        text-decoration: none;
        font-family: 'Courier New', Courier, monospace;
        backdrop-filter: blur(3px);
        transition: all 0.3s ease;
    }

    /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ï‡∏≠‡∏ô‡πÄ‡∏≠‡∏≤‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÑ‡∏õ‡∏ä‡∏µ‡πâ */
    .portal-back-btn:hover {
        background-color: rgba(255, 255, 255, 0.9);
        color: #000000;
        border-color: #ffffff;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        transform: translateY(-2px); /* ‡∏•‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢‡πÉ‡∏´‡∏ç‡πà */
    }
</style>

<a href="https://prthachnu999.github.io/My-Personal-Space/" class="portal-back-btn">
        <span style="font-size: 1.2em;">‚Üê</span> Home
    </a>

    <style>
        .portal-back-btn {
            position: fixed;
            bottom: 15px; left: 15px; z-index: 9999;
            background-color: rgba(0, 0, 0, 0.6);
            color: #cccccc;
            padding: 5px 12px;
            font-size: 0.85rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            text-decoration: none;
            font-family: 'Courier New', Courier, monospace;
            backdrop-filter: blur(3px);
            transition: all 0.3s ease;
        }
        .portal-back-btn:hover {
            background-color: rgba(255, 255, 255, 0.9);
            color: #000000;
            border-color: #ffffff;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }
    </style>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('LinkStar App Ready!', reg))
                    .catch(err => console.log('LinkStar App Failed', err));
            });
        }
    </script>

</body>
</html>